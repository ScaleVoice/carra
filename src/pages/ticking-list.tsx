import { Flex } from 'components/Flex'
import { Header } from 'components/header/Header'
import { TableLayout } from 'components/layout/TableLayout'
import { GetStaticProps } from 'next'
import Head from 'next/head'
import { TableFilters } from 'sections/filtering/TableFilters'
import { TableFiltersToolbar } from 'sections/filtering/TableFiltersToolbar'
import { initialState } from 'sections/filtering/reducer/FiltersState'
import { useTickingListFilters } from 'sections/tickingList/filters/TickingListFilters'
import { TickingListTable } from 'sections/tickingList/table/TickingListTable'
import { getIntlProps } from 'utils/i18n/getIntlProps'

export default function Home() {
  const {
    filters,
    defaultSearch,
    onSearch,
    clear,
    openedFilters,
    toggleOpenFilters,
    activeFilters
  } = useTickingListFilters()

  return (
    <>
      <Head>
        <title>Ticking app | List</title>
        <meta name="description" content="Generated by create next app" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      <main>
        <Header hasShadow />

        <TableLayout openedFilters={openedFilters}>
          <TableFilters
            filters={filters}
            openedFilters={openedFilters}
            toggleFiltersMenu={toggleOpenFilters}
          />

          <Flex variant="column">
            <TableFiltersToolbar
              initialFilters={initialState.tickingList.filters}
              activeFilters={activeFilters}
              filters={filters}
              onClearAll={clear}
              onSearch={onSearch}
              defaultSearch={defaultSearch}
            />

            <TickingListTable />
          </Flex>
        </TableLayout>
      </main>
    </>
  )
}

export const getStaticProps: GetStaticProps = async ctx => {
  return {
    props: {
      ...(await getIntlProps(ctx, 'tickingList'))
    }
  }
}
